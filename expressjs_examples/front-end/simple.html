<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Speech - Speak.JS Export</title>
  </head>
  <body>
    <textarea id="textInput" placeholder="Enter text">hello world how are you doing today? I am your personal assistant</textarea><br>
    <select id="voiceSelect"></select><br>
    <button id="playButton">Play</button>
    <button id="stopButton">Stop</button>

    <audio id="audioPlayer" controls></audio>

    <script>
      const playButton = document.getElementById('playButton');
      const stopButton = document.getElementById('stopButton');
      const audioPlayer = document.getElementById('audioPlayer');
      const textInput = document.getElementById('textInput');
      const voiceSelect = document.getElementById('voiceSelect');
      fetch('/voices').then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      }).then(voices => {
        const voiceSelect = document.getElementById('voiceSelect');
        voiceSelect.innerHTML = '';
        voices.forEach(voice => {
          const option = document.createElement('option');
          option.value = voice;
          option.textContent = voice;
          voiceSelect.appendChild(option);
        });
      }).catch(error => {
        console.error('There was a problem fetching available voices:', error);
      });

      playButton.addEventListener('click', () => {
        const text = textInput.value;
        const voice = voiceSelect.value;
        fetch('/tts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ text, voice })
        }).then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.blob();
        }).then(blob => {
          const blobURL = URL.createObjectURL(blob);
          audioPlayer.src = blobURL;
          audioPlayer.play();
        })
      });

      stopButton.addEventListener('click', () => {
        audioPlayer.pause();
        audioPlayer.currentTime = 0;
      });
    </script>
  </body>
</html>
