<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Text-to-Speech - Speak.JS Stream</title>
    </head>
    <body>
        <!-- Created by Burgil -->
        <textarea id="textInput" placeholder="Enter text">hello world how are you doing today? I am your personal assistant</textarea><br>
        <select id="voiceSelect"></select><br>
        <button id="playButton">Play</button>

        <script>
            const playButton = document.getElementById('playButton');
            const textInput = document.getElementById('textInput');
            const voiceSelect = document.getElementById('voiceSelect');

            // Created by Burgil
            fetch('http://localhost/voices').then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            }).then(voices => {
                const voiceSelect = document.getElementById('voiceSelect');
                voiceSelect.innerHTML = '';
                voices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice;
                    option.textContent = voice;
                    voiceSelect.appendChild(option);
                });
            }).catch(error => {
                console.error('There was a problem fetching available voices:', error);
            });

            // Created by Burgil

            // Play button click event listener
            playButton.addEventListener('click', async () => {
                const text = textInput.value;
                const voice = voiceSelect.value;
                try {
                    const response = await fetch('http://localhost/tts-stream', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ text, voice })
                    });
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const audioContext = new AudioContext();
                    const audioData = await response.arrayBuffer();
                    audioContext.decodeAudioData(audioData, buffer => {
                        const source = audioContext.createBufferSource();
                        source.buffer = buffer;
                        source.connect(audioContext.destination);
                        source.start();
                    }, error => {
                        console.error('Error decoding audio data:', error);
                    });
                } catch (error) {
                    console.error('There was a problem playing audio:', error);
                }
            });

            // playButton.addEventListener('click', async () => {
            //     const text = textInput.value;
            //     const voice = voiceSelect.value;
            //     try {
            //         const response = await fetch('http://localhost/tts-stream', {
            //             method: 'POST',
            //             headers: {
            //                 'Content-Type': 'application/json'
            //             },
            //             body: JSON.stringify({ text, voice })
            //         });
            //         if (!response.ok) {
            //             throw new Error('Network response was not ok');
            //         }
            //         const audioContext = new AudioContext();
            //         let audioBuffer;
            //         const audioData = await response.arrayBuffer();
            //         console.log('audioData', audioData)
            //         audioBuffer = await audioContext.decodeAudioData(audioData);
            //         const source = audioContext.createBufferSource();
            //         source.buffer = audioBuffer;
            //         source.connect(audioContext.destination);
            //         source.start();
            //     } catch (error) {
            //         console.error('There was a problem playing audio:', error);
            //     }
            // });

            // Created by Burgil
        </script>
    </body>
</html>
